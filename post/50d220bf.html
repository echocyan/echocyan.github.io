<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>CSAPP 实验 2 ：Bomb Lab | 舰艏上浪的小站</title><meta name="author" content="EchoCyan"><meta name="copyright" content="EchoCyan"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="CSAPP 实验 2 ：Bomb Lab 引言 Bomb Lab 实验文件目录如下 1234bomb├── bomb├── bomb.c└── README  bomb: 二进制可执行程序 bomb: 程序的主函数 main 的源文件 README: This is an x86-64 bomb for self-study students.   阅读 bomb.c 文件 12345678910"><meta property="og:type" content="article"><meta property="og:title" content="CSAPP 实验 2 ：Bomb Lab"><meta property="og:url" content="https://www.echocyan.top/post/50d220bf.html"><meta property="og:site_name" content="舰艏上浪的小站"><meta property="og:description" content="CSAPP 实验 2 ：Bomb Lab 引言 Bomb Lab 实验文件目录如下 1234bomb├── bomb├── bomb.c└── README  bomb: 二进制可执行程序 bomb: 程序的主函数 main 的源文件 README: This is an x86-64 bomb for self-study students.   阅读 bomb.c 文件 12345678910"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.echocyan.top/images/avatar.webp"><meta property="article:published_time" content="2025-11-25T12:30:58.000Z"><meta property="article:modified_time" content="2025-12-15T12:58:28.023Z"><meta property="article:author" content="EchoCyan"><meta property="article:tag" content="学习笔记"><meta property="article:tag" content="汇编"><meta property="article:tag" content="计组"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.echocyan.top/images/avatar.webp"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "CSAPP 实验 2 ：Bomb Lab",
  "url": "https://www.echocyan.top/post/50d220bf.html",
  "image": "https://www.echocyan.top/images/avatar.webp",
  "datePublished": "2025-11-25T12:30:58.000Z",
  "dateModified": "2025-12-15T12:58:28.023Z",
  "author": [
    {
      "@type": "Person",
      "name": "EchoCyan",
      "url": "https://www.echocyan.top"
    }
  ]
}</script><link rel="shortcut icon" href="/images/favicon.ico"><link rel="canonical" href="https://www.echocyan.top/post/50d220bf.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css?v=5.5.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>(()=>{const e={set:(e,t,o)=>{if(!o)return;const a=Date.now()+864e5*o;localStorage.setItem(e,JSON.stringify({value:t,expiry:a}))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const{value:o,expiry:a}=JSON.parse(t);if(!(Date.now()>a))return o;localStorage.removeItem(e)}};window.btf={saveToLocal:e,getScript:(e,t={})=>new Promise((o,a)=>{const n=document.createElement("script");n.src=e,n.async=!0,Object.entries(t).forEach(([e,t])=>n.setAttribute(e,t)),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),getCSS:(e,t)=>new Promise((o,a)=>{const n=document.createElement("link");n.rel="stylesheet",n.href=e,t&&(n.id=t),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),addGlobalFn:(e,t,o=!1,a=window)=>{if(e.startsWith("pjax"))return;const n=a.globalFn||{};n[e]=n[e]||{},n[e][o||Object.keys(n[e]).length]=t,a.globalFn=n}};const t=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},o=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","ffffff")};btf.activateDarkMode=t,btf.activateLightMode=o;const a=e.get("theme");"dark"===a?t():"light"===a&&o();const n=e.get("aside-status");void 0!==n&&document.documentElement.classList.toggle("hide-aside","hide"===n);/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})()</script><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"/search.json",preload:!1,top_n_per_article:1,unescape:!1,pagination:{enable:!1,hitsPerPage:8},languages:{hits_empty:"未找到符合您查询的内容：${query}",hits_stats:"共找到 ${hits} 篇文章"}},translate:void 0,highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:200,highlightFullpage:!1,highlightMacStyle:!1},copy:{success:"复制成功",error:"复制失败",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"天",dateSuffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:void 0,lightbox:"null",Snackbar:void 0,infinitegrid:{js:"https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js",buttonText:"加载更多"},isPhotoFigcaption:!1,islazyloadPlugin:!1,isAnchor:!1,percent:{toc:!0,rightside:!1},autoDarkmode:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"CSAPP 实验 2 ：Bomb Lab",isHighlightShrink:!1,isToc:!0,pageType:"post"}</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload='this.media="all"'><link rel="stylesheet" href="/css/universe.css"><meta name="generator" content="Hexo 8.1.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>(()=>{const e=document.getElementById("loading-box"),d=document.body,t=()=>{e.classList.contains("loaded")||(d.style.overflow="",e.classList.add("loaded"))},o=()=>{d.style.overflow="hidden",e.classList.remove("loaded")};o(),"complete"===document.readyState?t():(window.addEventListener("load",t),document.addEventListener("DOMContentLoaded",t),setTimeout(t,7e3))})()</script><div id="web_bg" style="background-image:url(/images/background.webp)"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/images/avatar.webp" onerror='this.onerror=null,this.src="/images/friend_404.gif"' alt="avatar"></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">22</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>主页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>关于</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-images"></i> <span>图库</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image:url(/images/background.webp)"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">舰艏上浪的小站</span></a><a class="nav-page-title" href="/"><span class="site-name">CSAPP 实验 2 ：Bomb Lab</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i> <span>返回首页</span></span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i> <span>搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>主页</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i> <span>关于</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fas fa-images"></i> <span>图库</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i> <span>友链</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">CSAPP 实验 2 ：Bomb Lab</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-11-25T12:30:58.000Z" title="发表于 2025-11-25 20:30:58">2025-11-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-12-15T12:58:28.023Z" title="更新于 2025-12-15 20:58:28">2025-12-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E8%AE%A1%E7%BB%84/">计组</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">7.4k</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1>CSAPP 实验 2 ：Bomb Lab</h1><h2 id="引言">引言</h2><p>Bomb Lab 实验文件目录如下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bomb</span><br><span class="line">├── bomb</span><br><span class="line">├── bomb.c</span><br><span class="line">└── README</span><br></pre></td></tr></table></figure><ul><li><code>bomb</code>: 二进制可执行程序</li><li><code>bomb</code>: 程序的主函数 main 的源文件</li><li><code>README</code>: <code>This is an x86-64 bomb for self-study students.</code></li></ul><p>阅读 <code>bomb.c</code> 文件</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;support.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;phases.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Note to self: Remember to erase this file so my victims will have no</span></span><br><span class="line"><span class="comment"> * idea what is going on, and so they will all blow up in a</span></span><br><span class="line"><span class="comment"> * spectaculary fiendish explosion. -- Dr. Evil</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">FILE *infile;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">char</span> *input;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Note to self: remember to port this bomb to Windows and put a</span></span><br><span class="line"><span class="comment">     * fantastic GUI on it. */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* When run with no arguments, the bomb reads its input lines</span></span><br><span class="line"><span class="comment">     * from standard input. */</span></span><br><span class="line">    <span class="keyword">if</span> (argc == <span class="number">1</span>) &#123;</span><br><span class="line">	infile = <span class="built_in">stdin</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* When run with one argument &lt;file&gt;, the bomb reads from &lt;file&gt;</span></span><br><span class="line"><span class="comment">     * until EOF, and then switches to standard input. Thus, as you</span></span><br><span class="line"><span class="comment">     * defuse each phase, you can add its defusing string to &lt;file&gt; and</span></span><br><span class="line"><span class="comment">     * avoid having to retype it. */</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (argc == <span class="number">2</span>) &#123;</span><br><span class="line">	<span class="keyword">if</span> (!(infile = fopen(argv[<span class="number">1</span>], <span class="string">&quot;r&quot;</span>))) &#123;</span><br><span class="line">	    <span class="built_in">printf</span>(<span class="string">&quot;%s: Error: Couldn&#x27;t open %s\n&quot;</span>, argv[<span class="number">0</span>], argv[<span class="number">1</span>]);</span><br><span class="line">	    <span class="built_in">exit</span>(<span class="number">8</span>);</span><br><span class="line">	&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* You can&#x27;t call the bomb with more than 1 command line argument. */</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Usage: %s [&lt;input_file&gt;]\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">	<span class="built_in">exit</span>(<span class="number">8</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Do all sorts of secret stuff that makes the bomb harder to defuse. */</span></span><br><span class="line">    initialize_bomb();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Welcome to my fiendish little bomb. You have 6 phases with\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;which to blow yourself up. Have a nice day!\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Hmm...  Six phases must be more secure than one phase! */</span></span><br><span class="line">    input = read_line();             <span class="comment">/* Get input                   */</span></span><br><span class="line">    phase_1(input);                  <span class="comment">/* Run the phase               */</span></span><br><span class="line">    phase_defused();                 <span class="comment">/* Drat!  They figured it out!</span></span><br><span class="line"><span class="comment">				      * Let me know how they did it. */</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Phase 1 defused. How about the next one?\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* The second phase is harder.  No one will ever figure out</span></span><br><span class="line"><span class="comment">     * how to defuse this... */</span></span><br><span class="line">    input = read_line();</span><br><span class="line">    phase_2(input);</span><br><span class="line">    phase_defused();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;That&#x27;s number 2.  Keep going!\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* I guess this is too easy so far.  Some more complex code will</span></span><br><span class="line"><span class="comment">     * confuse people. */</span></span><br><span class="line">    input = read_line();</span><br><span class="line">    phase_3(input);</span><br><span class="line">    phase_defused();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Halfway there!\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Oh yeah?  Well, how good is your math?  Try on this saucy problem! */</span></span><br><span class="line">    input = read_line();</span><br><span class="line">    phase_4(input);</span><br><span class="line">    phase_defused();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;So you got that one.  Try this one.\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Round and &#x27;round in memory we go, where we stop, the bomb blows! */</span></span><br><span class="line">    input = read_line();</span><br><span class="line">    phase_5(input);</span><br><span class="line">    phase_defused();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Good work!  On to the next...\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* This phase will never be used, since no one will get past the</span></span><br><span class="line"><span class="comment">     * earlier ones.  But just in case, make this one extra hard. */</span></span><br><span class="line">    input = read_line();</span><br><span class="line">    phase_6(input);</span><br><span class="line">    phase_defused();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Wow, they got it!  But isn&#x27;t something... missing?  Perhaps</span></span><br><span class="line"><span class="comment">     * something they overlooked?  Mua ha ha ha ha! */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以发现，在 main 函数中，总共有 6 个相似的 phase，每个 phase 读入一行输入，并调用 phase 函数和<code>phase_defused()</code>函数判断是否成功拆弹。</p><p>我们首先运行一下<code>bomb</code>程序，输入<code>hello</code></p><p><img src="https://image.echocyan.top/20251119214454807.webp" alt=""></p><p>很显然炸弹爆炸了，我们的输入不符合要求。</p><p>我们首先对<code>bomb</code>反汇编，输入命令<code>objdump -d bomb &gt; bomb.asm</code>，这行命令将<code>bomb</code>这个文件反汇编，并将结果保存到<code>bomb.asm</code>文件中。</p><p>阅读<code>bomb.asm</code>文件，可以找到 6 个 phase</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">0000000000400ee0 &lt;phase_1&gt;:</span><br><span class="line">  400ee0:	48 83 ec 08          	sub    $0x8,%rsp</span><br><span class="line">  400ee4:	be 00 24 40 00       	mov    $0x402400,%esi</span><br><span class="line">  400ee9:	e8 4a 04 00 00       	call   401338 &lt;strings_not_equal&gt;</span><br><span class="line">  400eee:	85 c0                	test   %eax,%eax</span><br><span class="line">  400ef0:	74 05                	je     400ef7 &lt;phase_1+0x17&gt;</span><br><span class="line">  400ef2:	e8 43 05 00 00       	call   40143a &lt;explode_bomb&gt;</span><br><span class="line">  400ef7:	48 83 c4 08          	add    $0x8,%rsp</span><br><span class="line">  400efb:	c3                   	ret</span><br><span class="line">0000000000400efc &lt;phase_2&gt;:</span><br><span class="line">......</span><br><span class="line">0000000000400f43 &lt;phase_3&gt;:</span><br><span class="line">......</span><br><span class="line">000000000040100c &lt;phase_4&gt;:</span><br><span class="line">......</span><br><span class="line">0000000000401062 &lt;phase_5&gt;:</span><br><span class="line">......</span><br><span class="line">00000000004010f4 &lt;phase_6&gt;:</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p><strong>将文件作为输入</strong></p><p>测试某个 phase 的答案时，运行<code>bomb</code>程序后都要手动重新输入前面几个 phase 的答案，这样未免太繁琐了，好在<code>bomb</code>文件中已经提示我们可以使用文件作为输入。</p><p>我们在目录下创建一个<code>txt</code>文件，名字随意，我这里叫<code>answer.txt</code>，输入<code>gdb bomb</code>命令启动调试器，输入<code>run answer.txt</code>命令将<code>answer.txt</code>文件作为输入。</p><h3 id="基础知识">基础知识</h3><h4 id="GDB-调试器常用命令">GDB 调试器常用命令</h4><p>这一部分不用死记硬背，用到的时候查就可以了</p><h5 id="1-启动与运行">1. 启动与运行</h5><table><thead><tr><th>命令</th><th>简写</th><th>作用</th><th>示例</th></tr></thead><tbody><tr><td>gdb<file></file></td><td></td><td>启动调试器</td><td>gdb bomb</td></tr><tr><td>run</td><td>r</td><td>开始运行程序</td><td>r 或 r solution.txt</td></tr><tr><td>kill</td><td></td><td>停止正在运行的程序</td><td>kill</td></tr><tr><td>quit</td><td>q</td><td>退出 GDB</td><td>q</td></tr></tbody></table><h5 id="2-断点控制">2. 断点控制</h5><table><thead><tr><th>命令</th><th>简写</th><th>作用</th><th>示例</th></tr></thead><tbody><tr><td>break<location></location></td><td>b</td><td>在函数名或地址处设断点</td><td>b phase_1 或 b *0x400ee0</td></tr><tr><td>info break</td><td>i b</td><td>查看当前所有断点</td><td>i b</td></tr><tr><td>delete<num></num></td><td>d</td><td>删除指定编号的断点</td><td>d 1</td></tr><tr><td>stepi</td><td>si</td><td><strong>单步执行</strong>（汇编级），遇到函数会进入</td><td>si</td></tr><tr><td>nexti</td><td>ni</td><td><strong>单步跳过</strong>（汇编级），遇到函数不进入</td><td>ni</td></tr><tr><td>continue</td><td>c</td><td>继续执行直到下一个断点</td><td>c</td></tr></tbody></table><h5 id="3-查看代码与寄存器">3. 查看代码与寄存器</h5><table><thead><tr><th>命令</th><th>简写</th><th>作用</th><th>示例</th></tr></thead><tbody><tr><td>disassemble</td><td>disas</td><td>反汇编当前函数</td><td>disas 或 disas phase_1</td></tr><tr><td>info registers</td><td>i r</td><td>查看所有寄存器的值</td><td>i r</td></tr><tr><td>print $<reg></reg></td><td>p</td><td>打印特定寄存器的值</td><td>p $rax</td></tr></tbody></table><h5 id="4-核心命令：查看内存-x">4. 核心命令：查看内存 (x)</h5><p><strong>格式：</strong> <code>x /&lt;数量&gt;&lt;格式&gt;&lt;单位&gt; &lt;地址&gt;</code></p><ul><li><strong>格式 (Format):</strong><ul><li><code>s</code>: 字符串 (String) —— 查看密码常用</li><li><code>d</code>: 十进制 (Decimal) —— 查看整数常用</li><li><code>x</code>: 十六进制 (Hex)</li><li><code>i</code>: 指令 (Instruction)</li></ul></li><li><strong>单位 (Unit):</strong><ul><li><code>b</code>: 1 字节 (Byte)</li><li><code>w</code>: 4 字节 (Word) —— <code>int</code> 通常是这个</li><li><code>g</code>: 8 字节 (Giant) —— 指针通常是这个</li></ul></li></ul><h4 id="x86-64-寄存器">x86-64 寄存器</h4><p><img src="https://image.echocyan.top/20251124193858839.webp" alt=""></p><h2 id="phase-1">phase_1</h2><p>我们首先逐行分析下汇编代码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">400ee0:	48 83 ec 08          	sub    $0x8,%rsp</span><br></pre></td></tr></table></figure><ul><li>将栈顶指针减去 8，这不重要，略过</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">400ee4:	be 00 24 40 00       	mov    $0x402400,%esi</span><br></pre></td></tr></table></figure><ul><li><p>将十六进制数<code>0x402400</code>存放到<code>%esi</code>寄存器中</p></li><li><p><code>%esi</code>寄存器是<code>%rsi</code>寄存器的低 32 位，相当于给函数第二个参数赋值</p></li><li><p>那么函数的第一个参数是什么呢？</p><ul><li>在调用这个函数时，我们是这样执行的 <code>phase_1(input)</code></li><li>所以，第一个参数<code>%rdi</code>已经存放了我们的之前的输入</li></ul></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">400ee9:	e8 4a 04 00 00       	call   401338 &lt;strings_not_equal&gt;</span><br></pre></td></tr></table></figure><ul><li>调用函数<code>strings_not_equal</code></li><li>看名字就知道，这个函数用来比较两个字符串是否相等</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">400eee:	85 c0                	test   %eax,%eax</span><br><span class="line">400ef0:	74 05                	je     400ef7 &lt;phase_1+0x17&gt;</span><br><span class="line">400ef2:	e8 43 05 00 00       	call   40143a &lt;explode_bomb&gt;</span><br></pre></td></tr></table></figure><ul><li><code>test</code>: 检查返回值<code>%eax</code>是否为 0</li><li><code>je</code>(Jump if Equal): 如果等于 0，就跳转到<code>400ef7</code>，如果不等，那么跳过这行代码，执行下面的<code>explode_bomb</code><ul><li>到这里我们可以推测<code>strings_not_equal</code>函数的判断条件<ul><li>如果两个字符串相等，返回 0，那么我们不会触发炸弹爆炸</li><li>如果两个字符串不相等，返回 1，炸弹爆炸</li></ul></li></ul></li></ul><p>我们可以尝试将这段汇编代码整理成伪代码的形式</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">phase_1</span><span class="params">(rdi)</span></span><br><span class="line">&#123;</span><br><span class="line">	esi = <span class="number">0x402400</span>;</span><br><span class="line">	result = stirng_not_equal(rdi,esi);</span><br><span class="line">	<span class="keyword">if</span>(result != <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		explode_bomb();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过以上分析，我们可以发现，关键是内存地址<code>0x402400</code></p><p>输入命令<code>x/s 0x402400</code>，其中，<code>x</code>= eXamine (检查内存)，<code>/s</code>= String (按字符串格式显示)。</p><p><img src="https://image.echocyan.top/20251119214410120.webp" alt=""></p><p>我们可以发现，答案就是<code>Border relations with Canada have never been better.</code></p><h2 id="phade-2">phade_2</h2><p>我们首先将这段汇编代码初步处理成伪代码</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">phase_2</span><span class="params">(rdi)</span></span><br><span class="line">&#123;</span><br><span class="line">    rsp -= <span class="number">0x28</span>;</span><br><span class="line">    rsi = rsp;</span><br><span class="line"></span><br><span class="line">    read_six_numbers();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(*rsp == <span class="number">1</span>)</span><br><span class="line">    	<span class="keyword">goto</span> <span class="number">400f</span>30;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        explode_bomb();</span><br><span class="line"></span><br><span class="line">    <span class="number">400f</span>17:</span><br><span class="line">    	eax = *(rbx - <span class="number">0x4</span>);</span><br><span class="line">    	eax += eax;</span><br><span class="line">    	<span class="keyword">if</span>(eax == *rbx)</span><br><span class="line">            <span class="keyword">goto</span> <span class="number">400f</span>25;</span><br><span class="line">    	<span class="keyword">else</span></span><br><span class="line">            explode_bomb();</span><br><span class="line">    <span class="number">400f</span>25:</span><br><span class="line">    	rbx += <span class="number">0x4</span>;</span><br><span class="line">    	<span class="keyword">if</span>(rbp != rbx)</span><br><span class="line">            <span class="keyword">goto</span> <span class="number">400f</span>17;</span><br><span class="line">    	<span class="keyword">else</span></span><br><span class="line">            <span class="keyword">goto</span> <span class="number">400f</span>3c;</span><br><span class="line"></span><br><span class="line">    <span class="number">400f</span>30:</span><br><span class="line">    	rbx = rsp + <span class="number">0x4</span>;</span><br><span class="line">    	rbp = rsp + <span class="number">0x18</span>;</span><br><span class="line">    	<span class="keyword">goto</span> <span class="number">400f</span>17;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>尝试阅读并理解这段代码，可以发现，其中蕴含着一个循环。我们作进一步整理。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">phase_2</span><span class="params">(rdi)</span></span><br><span class="line">&#123;</span><br><span class="line">    rsp -= <span class="number">0x28</span>; <span class="comment">// 栈顶指针减0x28，在栈上开辟空间</span></span><br><span class="line">    rsi = rsp;</span><br><span class="line"></span><br><span class="line">    read_six_numbers(rdi,rsi);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(*rsp != <span class="number">1</span>) explode_bomb();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 初始化，400f30</span></span><br><span class="line">    rbx = rsp + <span class="number">0x4</span>;</span><br><span class="line">    rbp = rsp + <span class="number">0x18</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(rbp != rbx) <span class="comment">//判断</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 进入循环体,400f17</span></span><br><span class="line">        eax = *(rbx - <span class="number">0x4</span>);</span><br><span class="line">    	eax += eax;</span><br><span class="line">    	<span class="keyword">if</span>(eax != *rbx) explode_bomb();</span><br><span class="line"></span><br><span class="line">        rbx += <span class="number">0x4</span>; <span class="comment">// 更新步进，400f25</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>整理后，此时就比较好理解了</p><p><img src="https://image.echocyan.top/20251120001419248.webp" alt=""></p><ol><li><code>read_six_numbers(rdi,rsi);</code>函数读取我们的输入，并将其写到之前开辟栈空间上。</li><li><code>rsp -= 0x28;</code>在栈上开辟了一块空间。<ol><li><code>rbp</code>为高位指针，初始指向<code>rsp + 0x18</code></li><li><code>rbx</code>为低位指针，初始指向<code>rsp + 0x4</code></li></ol></li><li><code>rsp</code>指向栈底，<code>*rsp</code>为 1</li><li><code>rbx</code>每次增加<code>0x4</code>，直到<code>rbp == rbx</code>，总计循环 5 次</li><li><code>eax</code>等于<code>*(rbx-0x4)</code>，由低位到高位每隔<code>0x4</code>逐步遍历，初始为 1 ，从 2 开始检查，每次倍增，一共循环五次</li></ol><p>所以栈上的数字应该是<code>1 2 4 8 16 32</code>。</p><h2 id="phase-3">phase_3</h2><p>我们一步步来分析 phase_3 的汇编代码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">0000000000400f43 &lt;phase_3&gt;:</span><br><span class="line">  400f43:	48 83 ec 18          	sub    $0x18,%rsp				;开辟栈空间</span><br><span class="line">  400f47:	48 8d 4c 24 0c       	lea    0xc(%rsp),%rcx			;第四个参数，不妨称其为y</span><br><span class="line">  400f4c:	48 8d 54 24 08       	lea    0x8(%rsp),%rdx			;第三个参数，不妨称其为x</span><br><span class="line">  400f51:	be cf 25 40 00       	mov    $0x4025cf,%esi</span><br><span class="line">  400f56:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  400f5b:	e8 90 fc ff ff       	call   400bf0 &lt;__isoc99_sscanf@plt&gt;	;调用sscanf函数</span><br><span class="line">  400f60:	83 f8 01             	cmp    $0x1,%eax				;比较sscanf返回值与1</span><br><span class="line">  400f63:	7f 05                	jg     400f6a &lt;phase_3+0x27&gt;	;如果返回值大于1，跳转</span><br><span class="line">  400f65:	e8 d0 04 00 00       	call   40143a &lt;explode_bomb&gt;	;如果返回值小于等于1，炸弹爆炸</span><br><span class="line">  400f6a:	83 7c 24 08 07       	cmpl   $0x7,0x8(%rsp)			;比较x与7</span><br><span class="line">  400f6f:	77 3c                	ja     400fad &lt;phase_3+0x6a&gt;	;如果大于则爆炸</span><br><span class="line">  400f71:	8b 44 24 08          	mov    0x8(%rsp),%eax			;把x放入%eax</span><br><span class="line">  400f75:	ff 24 c5 70 24 40 00 	jmp    *0x402470(,%rax,8)		;间接跳转</span><br><span class="line">  400f7c:	b8 cf 00 00 00       	mov    $0xcf,%eax				;%eax等于207</span><br><span class="line">  400f81:	eb 3b                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400f83:	b8 c3 02 00 00       	mov    $0x2c3,%eax</span><br><span class="line">  400f88:	eb 34                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400f8a:	b8 00 01 00 00       	mov    $0x100,%eax</span><br><span class="line">  400f8f:	eb 2d                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400f91:	b8 85 01 00 00       	mov    $0x185,%eax</span><br><span class="line">  400f96:	eb 26                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400f98:	b8 ce 00 00 00       	mov    $0xce,%eax</span><br><span class="line">  400f9d:	eb 1f                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400f9f:	b8 aa 02 00 00       	mov    $0x2aa,%eax</span><br><span class="line">  400fa4:	eb 18                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400fa6:	b8 47 01 00 00       	mov    $0x147,%eax</span><br><span class="line">  400fab:	eb 11                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400fad:	e8 88 04 00 00       	call   40143a &lt;explode_bomb&gt;</span><br><span class="line">  400fb2:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  400fb7:	eb 05                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">  400fb9:	b8 37 01 00 00       	mov    $0x137,%eax</span><br><span class="line">  400fbe:	3b 44 24 0c          	cmp    0xc(%rsp),%eax			;比较y和%eax</span><br><span class="line">  400fc2:	74 05                	je     400fc9 &lt;phase_3+0x86&gt;	;如果相等，过关</span><br><span class="line">  400fc4:	e8 71 04 00 00       	call   40143a &lt;explode_bomb&gt;	;否则爆炸</span><br><span class="line">  400fc9:	48 83 c4 18          	add    $0x18,%rsp</span><br><span class="line">  400fcd:	c3                   	ret</span><br></pre></td></tr></table></figure><p>我们首先注意到</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">400f5b:	e8 90 fc ff ff       	call   400bf0 &lt;__isoc99_sscanf@plt&gt;</span><br></pre></td></tr></table></figure><p>这里调用了<code>sscnaf</code>函数，<code>sscanf</code>的 C 语言函数签名为<code>int sscanf(const char *str, const char *format, ...)</code>，返回值表示成功匹配并赋值的参数个数。</p><p>又注意到</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">400f51:	be cf 25 40 00       	mov    $0x4025cf,%esi</span><br></pre></td></tr></table></figure><p><code>%esi</code>寄存器存储第二个参数，即<code>sscanf</code>函数的格式化字符串，在终端中输入<code>x/s 0x4025cf</code>，发现终端输出</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(gdb) x/s 0x4025cf</span><br><span class="line">0x4025cf:       &quot;%d %d&quot;</span><br></pre></td></tr></table></figure><p>这表明<code>sscanf</code>函数的第二个参数格式化字符串为两个整数，说明函数的第三和第四个参数，即要写入的变量是两个整数。</p><p>我们又知道，通常第三和第四个参数用<code>%rdx</code>和<code>%rcx</code>寄存器存储，注意到这两行</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">400f47:	48 8d 4c 24 0c       	lea    0xc(%rsp),%rcx</span><br><span class="line">400f4c:	48 8d 54 24 08       	lea    0x8(%rsp),%rdx</span><br></pre></td></tr></table></figure><ul><li><p><code>lea</code>（Load Effective Address) 是取地址</p></li><li><p>第三个参数<code>%rdx</code>对应第一个<code>%d</code>，表明这里存储的地址是栈地址<code>%rsp + 12</code></p></li><li><p>第四个参数<code>%rcx</code>对应第二个<code>%d</code>，表明这里存储的地址是栈地址<code>%rsp + 8</code></p></li><li><p>这两个地址是<code>sscanf</code>函数将要写入的地方，我们不妨称其为<code>x</code>和<code>y</code></p></li></ul><p>我们接着来看</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">400f60:	83 f8 01             	cmp    $0x1,%eax</span><br><span class="line">400f63:	7f 05                	jg     400f6a &lt;phase_3+0x27&gt;</span><br><span class="line">400f65:	e8 d0 04 00 00       	call   40143a &lt;explode_bomb&gt;</span><br></pre></td></tr></table></figure><p>这里对<code>sscanf</code>函数的返回值做比较，如果返回值大于 1，跳转到<code>400f6a</code>，否则炸弹爆炸。</p><p>我们继续向下看</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">400f6a:	83 7c 24 08 07       	cmpl   $0x7,0x8(%rsp)			;比较x与7</span><br><span class="line">400f6f:	77 3c                	ja     400fad &lt;phase_3+0x6a&gt;	;如果大于则爆炸</span><br><span class="line">400f71:	8b 44 24 08          	mov    0x8(%rsp),%eax			;把x放入%eax</span><br></pre></td></tr></table></figure><p>这说明<code>x</code>必须是 <strong>0 到 7</strong> 之间的一个数字(ja 用于无符号数的比较)，</p><p><strong>跳转表</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">400f75:	ff 24 c5 70 24 40 00 	jmp    *0x402470(,%rax,8)		;间接跳转</span><br></pre></td></tr></table></figure><ul><li>这个指令会不是跳转到一个固定的地址，而是先计算出一个地址再跳转</li><li><code>Address = *(0x402470 + %rax + 8)</code></li><li><code>0x402470</code>是一个数组起始地址</li><li><code>%rax</code>是一个索引</li><li><code>8</code>是因为在 64 位系统中，内存地址占 8 个字节</li></ul><p>注意到我们之前已经将把<code>x</code>放入<code>%eax</code>中了，所以这里会根据我们输入的<code>x</code>的值，来决定跳转到哪里</p><p>我们打开<code>gdb</code>调试器，输入<code>x/8xg 0x402470</code></p><ul><li><code>8</code>表示显示数量，显示 8 个内存单元</li><li><code>x</code>表示显示格式，显示十六进制</li><li><code>g</code>表达数据大小，(Giant words)表示 8 个字节</li></ul><p>可以看到终端输出</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0x402470:       0x0000000000400f7c      0x0000000000400fb9</span><br><span class="line">0x402480:       0x0000000000400f83      0x0000000000400f8a</span><br><span class="line">0x402490:       0x0000000000400f91      0x0000000000400f98</span><br><span class="line">0x4024a0:       0x0000000000400f9f      0x0000000000400fa6</span><br></pre></td></tr></table></figure><p><code>gdb</code>调试器为了节省空间，每行展示了两个内存值，完整显示是这样的</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">0x402470:       0x0000000000400f7c</span><br><span class="line">0x402478:       0x0000000000400fb9</span><br><span class="line">0x402480:       0x0000000000400f83</span><br><span class="line">0x402488:       0x0000000000400f8a</span><br><span class="line">0x402490:       0x0000000000400f91</span><br><span class="line">0x402498:       0x0000000000400f98</span><br><span class="line">0x4024a0:       0x0000000000400f9f</span><br><span class="line">0x4024a8:       0x0000000000400fa6</span><br></pre></td></tr></table></figure><p>这样就很清晰了，这说明我们输入的<code>x</code>索引要跳转到的对应的内存地址</p><p>我们接着往下看</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">400f7c:	b8 cf 00 00 00       	mov    $0xcf,%eax</span><br><span class="line">400f81:	eb 3b                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">400f83:	b8 c3 02 00 00       	mov    $0x2c3,%eax</span><br><span class="line">400f88:	eb 34                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">400f8a:	b8 00 01 00 00       	mov    $0x100,%eax</span><br><span class="line">400f8f:	eb 2d                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">400f91:	b8 85 01 00 00       	mov    $0x185,%eax</span><br><span class="line">400f96:	eb 26                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">400f98:	b8 ce 00 00 00       	mov    $0xce,%eax</span><br><span class="line">400f9d:	eb 1f                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">400f9f:	b8 aa 02 00 00       	mov    $0x2aa,%eax</span><br><span class="line">400fa4:	eb 18                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br><span class="line">400fa6:	b8 47 01 00 00       	mov    $0x147,%eax</span><br><span class="line">400fab:	eb 11                	jmp    400fbe &lt;phase_3+0x7b&gt;</span><br></pre></td></tr></table></figure><p>这里的代码结构高度相似，都是先给<code>%eax</code>赋一个值，再跳转到<code>400fbe</code></p><p>结合前一步分析，我们可以得出以下映射表</p><table><thead><tr><th>输入 x (%rax)</th><th>内存地址</th><th>跳转目标</th><th>对应逻辑</th></tr></thead><tbody><tr><td><strong>0</strong></td><td>0x402470</td><td><strong>0x400f7c</strong></td><td>mov $0xcf, %eax -&gt; 207</td></tr><tr><td><strong>1</strong></td><td>0x402478</td><td><strong>0x400fb9</strong></td><td>mov $0x137, %eax -&gt; 311</td></tr><tr><td><strong>2</strong></td><td>0x402480</td><td><strong>0x400f83</strong></td><td>mov $0x2c3, %eax -&gt; 707</td></tr><tr><td><strong>3</strong></td><td>0x402488</td><td><strong>0x400f8a</strong></td><td>mov $0x100, %eax -&gt; 256</td></tr><tr><td><strong>4</strong></td><td>0x402490</td><td><strong>0x400f91</strong></td><td>mov $0x185, %eax -&gt; 389</td></tr><tr><td><strong>5</strong></td><td>0x402498</td><td><strong>0x400f98</strong></td><td>mov $0xce, %eax -&gt; 206</td></tr><tr><td><strong>6</strong></td><td>0x4024a0</td><td><strong>0x400f9f</strong></td><td>mov $0x2aa, %eax -&gt; 682</td></tr><tr><td><strong>7</strong></td><td>0x4024a8</td><td><strong>0x400fa6</strong></td><td>mov $0x147, %eax -&gt; 327</td></tr></tbody></table><p>最后比较输入<code>y</code>和<code>%eax</code>，如果相等则过关，否则炸弹爆炸</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">400fbe:	3b 44 24 0c          	cmp    0xc(%rsp),%eax</span><br><span class="line">400fc2:	74 05                	je     400fc9 &lt;phase_3+0x86&gt;</span><br><span class="line">400fc4:	e8 71 04 00 00       	call   40143a &lt;explode_bomb&gt;</span><br></pre></td></tr></table></figure><p>综合以上分析，答案呼之欲出，我们要输入两个数字<code>x</code>和<code>y</code>，<code>x</code>为 0 到 7 之间的一个整数，<code>y</code>为与之对应的一个整数</p><p>随意填入以下一组数据即可</p><ul><li>0 207</li><li>1 311</li><li>2 707</li><li>3 256</li><li>4 389</li><li>5 206</li><li>6 682</li><li>7 327</li></ul><h2 id="phase-4">phase_4</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">000000000040100c &lt;phase_4&gt;:</span><br><span class="line">  40100c:	48 83 ec 18          	sub    $0x18,%rsp</span><br><span class="line">  401010:	48 8d 4c 24 0c       	lea    0xc(%rsp),%rcx				;第二个数y的地址</span><br><span class="line">  401015:	48 8d 54 24 08       	lea    0x8(%rsp),%rdx				;第一个数x的地址</span><br><span class="line">  40101a:	be cf 25 40 00       	mov    $0x4025cf,%esi				;&quot;%d %d&quot;</span><br><span class="line">  40101f:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  401024:	e8 c7 fb ff ff       	call   400bf0 &lt;__isoc99_sscanf@plt&gt;	;调用函数sscanf</span><br><span class="line">  401029:	83 f8 02             	cmp    $0x2,%eax					;比较返回值%eax与2</span><br><span class="line">  40102c:	75 07                	jne    401035 &lt;phase_4+0x29&gt;		;如果不相等则跳转</span><br><span class="line">  40102e:	83 7c 24 08 0e       	cmpl   $0xe,0x8(%rsp)				;比较14和x</span><br><span class="line">  401033:	76 05                	jbe    40103a &lt;phase_4+0x2e&gt;		;jump if below or equal</span><br><span class="line">  401035:	e8 00 04 00 00       	call   40143a &lt;explode_bomb&gt;		;如果大于则爆炸</span><br><span class="line">  40103a:	ba 0e 00 00 00       	mov    $0xe,%edx					;%edx = 14</span><br><span class="line">  40103f:	be 00 00 00 00       	mov    $0x0,%esi					;%esi = 0</span><br><span class="line">  401044:	8b 7c 24 08          	mov    0x8(%rsp),%edi				;%edi = x</span><br><span class="line">  401048:	e8 81 ff ff ff       	call   400fce &lt;func4&gt;				;调用函数func4</span><br><span class="line">  40104d:	85 c0                	test   %eax,%eax					;检查%eax是否为0</span><br><span class="line">  40104f:	75 07                	jne    401058 &lt;phase_4+0x4c&gt;		;如果非0，炸弹爆炸</span><br><span class="line">  401051:	83 7c 24 0c 00       	cmpl   $0x0,0xc(%rsp)				;比较y和0</span><br><span class="line">  401056:	74 05                	je     40105d &lt;phase_4+0x51&gt;		;如果相等，过关</span><br><span class="line">  401058:	e8 dd 03 00 00       	call   40143a &lt;explode_bomb&gt;		;否则，炸弹爆炸</span><br><span class="line">  40105d:	48 83 c4 18          	add    $0x18,%rsp</span><br><span class="line">  401061:	c3                   	ret</span><br></pre></td></tr></table></figure><p>这里前面和<code>phase_3</code>类似，不再赘述</p><p>同样的，我们要输入两个整数<code>x</code>和<code>y</code>，<code>x</code>必须在 0 到 14 之间</p><p>注意，这里调用了一个函数<code>func4</code>，传入的参数分别为<code>x</code>，<code>0</code>，<code>14</code>，且<code>func4</code>返回值必须为 0</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">40103a:	mov    $0xe,%edx            ; 参数 3 (%edx) = 14</span><br><span class="line">40103f:	mov    $0x0,%esi            ; 参数 2 (%esi) = 0</span><br><span class="line">401044:	mov    0x8(%rsp),%edi       ; 参数 1 (%edi) = x</span><br><span class="line">401048:	call   400fce &lt;func4&gt;       ; 调用 func4(x, 0, 14)</span><br><span class="line">40104d:	85 c0                	test   %eax,%eax					;检查%eax是否为0</span><br><span class="line">40104f:	75 07                	jne    401058 &lt;phase_4+0x4c&gt;		;如果非0，炸弹爆炸</span><br></pre></td></tr></table></figure><p>我们接着往下看</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">401051:	83 7c 24 0c 00       	cmpl   $0x0,0xc(%rsp)				;比较y和0</span><br><span class="line">401056:	74 05                	je     40105d &lt;phase_4+0x51&gt;		;如果相等，过关</span><br><span class="line">401058:	e8 dd 03 00 00       	call   40143a &lt;explode_bomb&gt;		;否则，炸弹爆炸</span><br></pre></td></tr></table></figure><p>这里我们可以推断第二个输入<code>y</code>必须为<code>0</code></p><p>那么接下来的问题就是<code>x</code>了，让我们来看看函数<code>func4</code>的代码</p><ul><li><code>%edi</code> = 第 1 个参数 <code>x</code></li><li><code>%esi</code> = 第 2 个参数 <code>0</code></li><li><code>%edx</code> = 第 3 个参数 <code>14</code></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">0000000000400fce &lt;func4&gt;:</span><br><span class="line">  400fce:	48 83 ec 08          	sub    $0x8,%rsp</span><br><span class="line">  400fd2:	89 d0                	mov    %edx,%eax			;%eax = %edx</span><br><span class="line">  400fd4:	29 f0                	sub    %esi,%eax			;%eax -= %esi</span><br><span class="line">  400fd6:	89 c1                	mov    %eax,%ecx			;%ecx = %eax</span><br><span class="line">  400fd8:	c1 e9 1f             	shr    $0x1f,%ecx			;逻辑右移，提出符号位</span><br><span class="line">  400fdb:	01 c8                	add    %ecx,%eax			;%eax += %ecx</span><br><span class="line">  400fdd:	d1 f8                	sar    $1,%eax				;%eax /= 2，算术右移</span><br><span class="line">  400fdf:	8d 0c 30             	lea    (%rax,%rsi,1),%ecx	;ecx = eax + esi</span><br><span class="line">  400fe2:	39 f9                	cmp    %edi,%ecx</span><br><span class="line">  400fe4:	7e 0c                	jle    400ff2 &lt;func4+0x24&gt;</span><br><span class="line">  400fe6:	8d 51 ff             	lea    -0x1(%rcx),%edx</span><br><span class="line">  400fe9:	e8 e0 ff ff ff       	call   400fce &lt;func4&gt;</span><br><span class="line">  400fee:	01 c0                	add    %eax,%eax</span><br><span class="line">  400ff0:	eb 15                	jmp    401007 &lt;func4+0x39&gt;</span><br><span class="line">  400ff2:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">  400ff7:	39 f9                	cmp    %edi,%ecx</span><br><span class="line">  400ff9:	7d 0c                	jge    401007 &lt;func4+0x39&gt;</span><br><span class="line">  400ffb:	8d 71 01             	lea    0x1(%rcx),%esi</span><br><span class="line">  400ffe:	e8 cb ff ff ff       	call   400fce &lt;func4&gt;</span><br><span class="line">  401003:	8d 44 00 01          	lea    0x1(%rax,%rax,1),%eax</span><br><span class="line">  401007:	48 83 c4 08          	add    $0x8,%rsp</span><br><span class="line">  40100b:	c3                   	ret</span><br></pre></td></tr></table></figure><p>我们将以上汇编代码整理成伪代码的形式</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">func4</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> a, <span class="type">int</span> b)</span></span><br><span class="line">&#123;</span><br><span class="line">    eax = b - a;</span><br><span class="line">    ecx = eax;</span><br><span class="line"></span><br><span class="line">    eax /= <span class="number">2</span>;</span><br><span class="line">    ecx = eax + a * <span class="number">1</span>;  <span class="comment">// ecx = ( b - a ) / 2 + a</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(ecx &lt;= x)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(ecx &gt;= x)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 也就是 ecx == x</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// ecx &lt; x，递归调用func4</span></span><br><span class="line">            result = func4(x, ecx + <span class="number">1</span>, b);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span> + <span class="number">2</span> * result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// ecx &gt; x，递归调用func4</span></span><br><span class="line">        result = func4(x, a, ecx - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>到这里就很清楚了，这是一个二分查找的递归函数，ecx 就是 mid，如果</p><ul><li>如果 mid == x，返回 <strong>0</strong>。</li><li>如果 mid &gt; x，返回 <strong>2 * 子结果</strong>。</li><li>如果 mid &lt; x，返回 <strong>2 * 子结果 + 1</strong>。</li></ul><p>我们前面提到过，<code>func4</code>函数返回值必须为<strong>0</strong>，那么返回值如何为 0 呢？就是在二分的过程中，<code>x</code>必须一直在左半边( &lt; mid )，或者<code>x</code>= mid，因为一旦<code>x</code>位于右半边，结果+1，就不可能为 0 了。</p><p>所以我们现在要找到一个<code>x</code>使得在二分<code>0</code>到<code>14</code>的情况下，要么 <code>x &lt; mid</code>，要么<code>x == mid</code>。</p><p>下面我们来手动算一下</p><ul><li>left = 0, right = 14<ul><li>mid = 0 + ( 14 - 0 ) / 2 = 7</li><li>若 x = 7，mid == x，返回 0</li><li>若 x &lt; 7 ，递归调用 func4(x, 0, 6)</li></ul></li><li>left = 0, right = 6<ul><li>mid = 0 + ( 6 - 0 ) / 2 = 3</li><li>若 x = 3, mid == x，返回 0</li><li>若 x &lt; 3 ，递归调用 func4(x, 0, 2)</li></ul></li><li>left = 0, right = 2<ul><li>mid = 0 + ( 2 - 0 ) / 2 = 1</li><li>若 x = 1, mid == x，返回 0</li><li>若 x &lt; 1( x == 0 ) ，递归调用 func4(x, 0, 0)</li></ul></li><li>left = 0, right = 0<ul><li>mid = 0 + ( 0 - 0 ) / 2 = 0</li><li>若 x = 0，mid == x，返回 0</li></ul></li></ul><p>综上，我们最终的答案(x，y)是</p><ul><li>7 0</li><li>3 0</li><li>1 0</li><li>0 0</li></ul><h2 id="phase-5">phase_5</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">0000000000401062 &lt;phase_5&gt;:</span><br><span class="line">  401062:	53                   	push   %rbx</span><br><span class="line">  401063:	48 83 ec 20          	sub    $0x20,%rsp</span><br><span class="line">  401067:	48 89 fb             	mov    %rdi,%rbx				;%rbx=%rdi</span><br><span class="line">  40106a:	64 48 8b 04 25 28 00 	mov    %fs:0x28,%rax			;这个不用管</span><br><span class="line">  401071:	00 00</span><br><span class="line">  401073:	48 89 44 24 18       	mov    %rax,0x18(%rsp)			;(%rsp+24)=rax</span><br><span class="line">  401078:	31 c0                	xor    %eax,%eax				;%eax=0</span><br><span class="line">  40107a:	e8 9c 02 00 00       	call   40131b &lt;string_length&gt;	;调用函数string_length</span><br><span class="line">  40107f:	83 f8 06             	cmp    $0x6,%eax				;检查字符串长度</span><br><span class="line">  401082:	74 4e                	je     4010d2 &lt;phase_5+0x70&gt;	;如果长度为6，跳转</span><br><span class="line">  401084:	e8 b1 03 00 00       	call   40143a &lt;explode_bomb&gt;	;否则，炸弹爆炸</span><br><span class="line">  401089:	eb 47                	jmp    4010d2 &lt;phase_5+0x70&gt;</span><br><span class="line">  40108b:	0f b6 0c 03          	movzbl (%rbx,%rax,1),%ecx		;%ecx=%rbx+%rax*1</span><br><span class="line">  40108f:	88 0c 24             	mov    %cl,(%rsp)</span><br><span class="line">  401092:	48 8b 14 24          	mov    (%rsp),%rdx</span><br><span class="line">  401096:	83 e2 0f             	and    $0xf,%edx</span><br><span class="line">  401099:	0f b6 92 b0 24 40 00 	movzbl 0x4024b0(%rdx),%edx</span><br><span class="line">  4010a0:	88 54 04 10          	mov    %dl,0x10(%rsp,%rax,1)</span><br><span class="line">  4010a4:	48 83 c0 01          	add    $0x1,%rax</span><br><span class="line">  4010a8:	48 83 f8 06          	cmp    $0x6,%rax</span><br><span class="line">  4010ac:	75 dd                	jne    40108b &lt;phase_5+0x29&gt;</span><br><span class="line">  4010ae:	c6 44 24 16 00       	movb   $0x0,0x16(%rsp)</span><br><span class="line">  4010b3:	be 5e 24 40 00       	mov    $0x40245e,%esi</span><br><span class="line">  4010b8:	48 8d 7c 24 10       	lea    0x10(%rsp),%rdi</span><br><span class="line">  4010bd:	e8 76 02 00 00       	call   401338 &lt;strings_not_equal&gt;</span><br><span class="line">  4010c2:	85 c0                	test   %eax,%eax</span><br><span class="line">  4010c4:	74 13                	je     4010d9 &lt;phase_5+0x77&gt;</span><br><span class="line">  4010c6:	e8 6f 03 00 00       	call   40143a &lt;explode_bomb&gt;</span><br><span class="line">  4010cb:	0f 1f 44 00 00       	nopl   0x0(%rax,%rax,1)</span><br><span class="line">  4010d0:	eb 07                	jmp    4010d9 &lt;phase_5+0x77&gt;</span><br><span class="line">  4010d2:	b8 00 00 00 00       	mov    $0x0,%eax				;将%eax初始化为 0</span><br><span class="line">  4010d7:	eb b2                	jmp    40108b &lt;phase_5+0x29&gt;</span><br><span class="line">  4010d9:	48 8b 44 24 18       	mov    0x18(%rsp),%rax</span><br><span class="line">  4010de:	64 48 33 04 25 28 00 	xor    %fs:0x28,%rax</span><br><span class="line">  4010e5:	00 00</span><br><span class="line">  4010e7:	74 05                	je     4010ee &lt;phase_5+0x8c&gt;</span><br><span class="line">  4010e9:	e8 42 fa ff ff       	call   400b30 &lt;__stack_chk_fail@plt&gt;</span><br><span class="line">  4010ee:	48 83 c4 20          	add    $0x20,%rsp</span><br><span class="line">  4010f2:	5b                   	pop    %rbx</span><br><span class="line">  4010f3:	c3                   	ret</span><br></pre></td></tr></table></figure><p>我们从<code>40107a</code>这一步开始分析</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">40107a:	e8 9c 02 00 00       	call   40131b &lt;string_length&gt;	;调用函数string_length</span><br><span class="line">40107f:	83 f8 06             	cmp    $0x6,%eax				;检查字符串长度</span><br><span class="line">401082:	74 4e                	je     4010d2 &lt;phase_5+0x70&gt;	;如果长度为6，跳转</span><br><span class="line">401084:	e8 b1 03 00 00       	call   40143a &lt;explode_bomb&gt;	;否则，炸弹爆炸</span><br></pre></td></tr></table></figure><p>这里表明我们的输入必须为 6 个字符的字符串</p><p>继续来看跳转到的<code>4010d2</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">4010d2:	b8 00 00 00 00       	mov    $0x0,%eax</span><br><span class="line">4010d7:	eb b2                	jmp    40108b &lt;phase_5+0x29&gt;</span><br></pre></td></tr></table></figure><p>这里将<code>%eax</code>初始化为 0，然后跳转回去</p><p>我们回头接着看</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">40108b:	0f b6 0c 03          	movzbl (%rbx,%rax,1),%ecx		;%ecx = input[i]，取出字符</span><br><span class="line">40108f:	88 0c 24             	mov    %cl,(%rsp)				;把字符存到栈上</span><br><span class="line">401092:	48 8b 14 24          	mov    (%rsp),%rdx				;又把字符读回到 %rdx</span><br><span class="line">401096:	83 e2 0f             	and    $0xf,%edx				;只保留低4位</span><br><span class="line">401099:	0f b6 92 b0 24 40 00 	movzbl 0x4024b0(%rdx),%edx		;查表</span><br><span class="line">4010a0:	88 54 04 10          	mov    %dl,0x10(%rsp,%rax,1)	;把查到的字符存入这个位置</span><br><span class="line">4010a4:	48 83 c0 01          	add    $0x1,%rax				;i++</span><br><span class="line">4010a8:	48 83 f8 06          	cmp    $0x6,%rax				;i&lt;6?</span><br><span class="line">4010ac:	75 dd                	jne    40108b &lt;phase_5+0x29&gt;	;继续循环</span><br><span class="line">4010ae:	c6 44 24 16 00       	movb   $0x0,0x16(%rsp)			;添加字符串结束符 \0</span><br></pre></td></tr></table></figure><ul><li><code>movzbl (%rbx,%rax,1),%ecx</code>，%ecx = %rbx + %rax * 1，%rbx 中存的是我们的输入字符串，%rax 在这里作为一个索引，初始为 0，这里的意思是取出<code>input[i]</code>，i 是索引</li><li><code>and $0xf,%edx</code>，<code>0xf</code>是二进制数<code>00001111</code>，这一步只保留了字符的低四位，意味着结果是一个 0 到 15 之间的数字</li><li><code>movzbl 0x4024b0(%rdx),%edx</code>，%edx = 0x4024b0 + %rbx，这一步相当于取 0x4024b0 这个数组上的第%rbx 个索引的值，我们这里输入命令<code>x/s 0x4024b0</code>，可以发现输出为<code>maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?</code></li></ul><p>我们用 c 语言来描述就是</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *table = (<span class="type">char</span> *)<span class="number">0x4024b0</span>; <span class="comment">// 这是一个长度为16的字符数组</span></span><br><span class="line"><span class="type">char</span> output[<span class="number">7</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">    <span class="type">int</span> index = input[i] &amp; <span class="number">0xF</span>; <span class="comment">// 取低4位</span></span><br><span class="line">    output[i] = table[index];   <span class="comment">// 查表替换</span></span><br><span class="line">&#125;</span><br><span class="line">output[<span class="number">6</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br></pre></td></tr></table></figure><p>我们继续向下看</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">4010b3:	be 5e 24 40 00       	mov    $0x40245e,%esi				;参数2，一个内存地址</span><br><span class="line">4010b8:	48 8d 7c 24 10       	lea    0x10(%rsp),%rdi				;参数1，我们之前生成的字符串output</span><br><span class="line">4010bd:	e8 76 02 00 00       	call   401338 &lt;strings_not_equal&gt;	;比较我output和这个内存地址中的值</span><br><span class="line">4010c2:	85 c0                	test   %eax,%eax</span><br><span class="line">4010c4:	74 13                	je     4010d9 &lt;phase_5+0x77&gt;		;如果相等，过关</span><br><span class="line">4010c6:	e8 6f 03 00 00       	call   40143a &lt;explode_bomb&gt;		;否则，爆炸</span><br></pre></td></tr></table></figure><p>我们输入<code>x/s 0x40245e</code>，可以看到终端的输出是<code>flyers</code></p><p>综合上述分析，我们推断，<code>*output = &quot;flyers&quot;</code>，我们接下来来推断<code>input</code></p><p>首先建立 <code>Table</code>表的字符和下标的映射关系</p><table><thead><tr><th>下标 (Hex)</th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10(a)</th><th>11(b)</th><th>12©</th><th>13(d)</th><th>14(e)</th><th>15(f)</th></tr></thead><tbody><tr><td><strong>字符</strong></td><td>m</td><td>a</td><td>d</td><td>u</td><td>i</td><td>e</td><td>r</td><td>s</td><td>n</td><td>f</td><td>o</td><td>t</td><td>v</td><td>b</td><td>y</td><td>l</td></tr></tbody></table><ol><li><strong>f</strong> -&gt; 在 Table 中对应下标 <strong>9</strong></li><li><strong>l</strong> -&gt; 在 Table 中对应下标 <strong>15 (0xF)</strong></li><li><strong>y</strong> -&gt; 在 Table 中对应下标 <strong>14 (0xE)</strong></li><li><strong>e</strong> -&gt; 在 Table 中对应下标 <strong>5</strong></li><li><strong>r</strong> -&gt; 在 Table 中对应下标 <strong>6</strong></li><li><strong>s</strong> -&gt; 在 Table 中对应下标 <strong>7</strong></li></ol><p>所以我们输入的 6 个字符，它们的低 4 位依次是：9、15、14、5、6、7</p><p>我们知道 ASCLL 码都是 8 比特，为了方便，我们转换成十六进制数就是：0x9、0xf、0xe、0x5、0x6、0x7</p><p>对于高 4 位，我们不妨填入 0x6，这里不唯一</p><p>那么答案就是，<code>ionefg</code></p><h2 id="phase-6">phase_6</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">00000000004010f4 &lt;phase_6&gt;:</span><br><span class="line">  4010f4:	41 56                	push   %r14</span><br><span class="line">  4010f6:	41 55                	push   %r13</span><br><span class="line">  4010f8:	41 54                	push   %r12</span><br><span class="line">  4010fa:	55                   	push   %rbp</span><br><span class="line">  4010fb:	53                   	push   %rbx</span><br><span class="line">  4010fc:	48 83 ec 50          	sub    $0x50,%rsp</span><br><span class="line">  401100:	49 89 e5             	mov    %rsp,%r13					;%r13指向栈顶指针%rsp</span><br><span class="line">  401103:	48 89 e6             	mov    %rsp,%rsi</span><br><span class="line">  401106:	e8 51 03 00 00       	call   40145c &lt;read_six_numbers&gt;	;读取6个数字</span><br><span class="line">  40110b:	49 89 e6             	mov    %rsp,%r14</span><br><span class="line">  40110e:	41 bc 00 00 00 00    	mov    $0x0,%r12d</span><br><span class="line">  401114:	4c 89 ed             	mov    %r13,%rbp</span><br><span class="line">  401117:	41 8b 45 00          	mov    0x0(%r13),%eax</span><br><span class="line">  40111b:	83 e8 01             	sub    $0x1,%eax</span><br><span class="line">  40111e:	83 f8 05             	cmp    $0x5,%eax</span><br><span class="line">  401121:	76 05                	jbe    401128 &lt;phase_6+0x34&gt;</span><br><span class="line">  401123:	e8 12 03 00 00       	call   40143a &lt;explode_bomb&gt;</span><br><span class="line">  401128:	41 83 c4 01          	add    $0x1,%r12d</span><br><span class="line">  40112c:	41 83 fc 06          	cmp    $0x6,%r12d</span><br><span class="line">  401130:	74 21                	je     401153 &lt;phase_6+0x5f&gt;</span><br><span class="line">  401132:	44 89 e3             	mov    %r12d,%ebx</span><br><span class="line">  401135:	48 63 c3             	movslq %ebx,%rax</span><br><span class="line">  401138:	8b 04 84             	mov    (%rsp,%rax,4),%eax</span><br><span class="line">  40113b:	39 45 00             	cmp    %eax,0x0(%rbp)</span><br><span class="line">  40113e:	75 05                	jne    401145 &lt;phase_6+0x51&gt;</span><br><span class="line">  401140:	e8 f5 02 00 00       	call   40143a &lt;explode_bomb&gt;</span><br><span class="line">  401145:	83 c3 01             	add    $0x1,%ebx</span><br><span class="line">  401148:	83 fb 05             	cmp    $0x5,%ebx</span><br><span class="line">  40114b:	7e e8                	jle    401135 &lt;phase_6+0x41&gt;</span><br><span class="line">  40114d:	49 83 c5 04          	add    $0x4,%r13</span><br><span class="line">  401151:	eb c1                	jmp    401114 &lt;phase_6+0x20&gt;</span><br><span class="line">  401153:	48 8d 74 24 18       	lea    0x18(%rsp),%rsi</span><br><span class="line">  401158:	4c 89 f0             	mov    %r14,%rax</span><br><span class="line">  40115b:	b9 07 00 00 00       	mov    $0x7,%ecx</span><br><span class="line">  401160:	89 ca                	mov    %ecx,%edx</span><br><span class="line">  401162:	2b 10                	sub    (%rax),%edx</span><br><span class="line">  401164:	89 10                	mov    %edx,(%rax)</span><br><span class="line">  401166:	48 83 c0 04          	add    $0x4,%rax</span><br><span class="line">  40116a:	48 39 f0             	cmp    %rsi,%rax</span><br><span class="line">  40116d:	75 f1                	jne    401160 &lt;phase_6+0x6c&gt;</span><br><span class="line">  40116f:	be 00 00 00 00       	mov    $0x0,%esi</span><br><span class="line">  401174:	eb 21                	jmp    401197 &lt;phase_6+0xa3&gt;</span><br><span class="line">  401176:	48 8b 52 08          	mov    0x8(%rdx),%rdx</span><br><span class="line">  40117a:	83 c0 01             	add    $0x1,%eax</span><br><span class="line">  40117d:	39 c8                	cmp    %ecx,%eax</span><br><span class="line">  40117f:	75 f5                	jne    401176 &lt;phase_6+0x82&gt;</span><br><span class="line">  401181:	eb 05                	jmp    401188 &lt;phase_6+0x94&gt;</span><br><span class="line">  401183:	ba d0 32 60 00       	mov    $0x6032d0,%edx</span><br><span class="line">  401188:	48 89 54 74 20       	mov    %rdx,0x20(%rsp,%rsi,2)</span><br><span class="line">  40118d:	48 83 c6 04          	add    $0x4,%rsi</span><br><span class="line">  401191:	48 83 fe 18          	cmp    $0x18,%rsi</span><br><span class="line">  401195:	74 14                	je     4011ab &lt;phase_6+0xb7&gt;</span><br><span class="line">  401197:	8b 0c 34             	mov    (%rsp,%rsi,1),%ecx</span><br><span class="line">  40119a:	83 f9 01             	cmp    $0x1,%ecx</span><br><span class="line">  40119d:	7e e4                	jle    401183 &lt;phase_6+0x8f&gt;</span><br><span class="line">  40119f:	b8 01 00 00 00       	mov    $0x1,%eax</span><br><span class="line">  4011a4:	ba d0 32 60 00       	mov    $0x6032d0,%edx</span><br><span class="line">  4011a9:	eb cb                	jmp    401176 &lt;phase_6+0x82&gt;</span><br><span class="line">  4011ab:	48 8b 5c 24 20       	mov    0x20(%rsp),%rbx</span><br><span class="line">  4011b0:	48 8d 44 24 28       	lea    0x28(%rsp),%rax</span><br><span class="line">  4011b5:	48 8d 74 24 50       	lea    0x50(%rsp),%rsi</span><br><span class="line">  4011ba:	48 89 d9             	mov    %rbx,%rcx</span><br><span class="line">  4011bd:	48 8b 10             	mov    (%rax),%rdx</span><br><span class="line">  4011c0:	48 89 51 08          	mov    %rdx,0x8(%rcx)</span><br><span class="line">  4011c4:	48 83 c0 08          	add    $0x8,%rax</span><br><span class="line">  4011c8:	48 39 f0             	cmp    %rsi,%rax</span><br><span class="line">  4011cb:	74 05                	je     4011d2 &lt;phase_6+0xde&gt;</span><br><span class="line">  4011cd:	48 89 d1             	mov    %rdx,%rcx</span><br><span class="line">  4011d0:	eb eb                	jmp    4011bd &lt;phase_6+0xc9&gt;</span><br><span class="line">  4011d2:	48 c7 42 08 00 00 00 	movq   $0x0,0x8(%rdx)</span><br><span class="line">  4011d9:	00</span><br><span class="line">  4011da:	bd 05 00 00 00       	mov    $0x5,%ebp</span><br><span class="line">  4011df:	48 8b 43 08          	mov    0x8(%rbx),%rax</span><br><span class="line">  4011e3:	8b 00                	mov    (%rax),%eax</span><br><span class="line">  4011e5:	39 03                	cmp    %eax,(%rbx)</span><br><span class="line">  4011e7:	7d 05                	jge    4011ee &lt;phase_6+0xfa&gt;</span><br><span class="line">  4011e9:	e8 4c 02 00 00       	call   40143a &lt;explode_bomb&gt;</span><br><span class="line">  4011ee:	48 8b 5b 08          	mov    0x8(%rbx),%rbx</span><br><span class="line">  4011f2:	83 ed 01             	sub    $0x1,%ebp</span><br><span class="line">  4011f5:	75 e8                	jne    4011df &lt;phase_6+0xeb&gt;</span><br><span class="line">  4011f7:	48 83 c4 50          	add    $0x50,%rsp</span><br><span class="line">  4011fb:	5b                   	pop    %rbx</span><br><span class="line">  4011fc:	5d                   	pop    %rbp</span><br><span class="line">  4011fd:	41 5c                	pop    %r12</span><br><span class="line">  4011ff:	41 5d                	pop    %r13</span><br><span class="line">  401201:	41 5e                	pop    %r14</span><br><span class="line">  401203:	c3                   	ret</span><br></pre></td></tr></table></figure><p>phase_6 的代码非常长，我们一步步来分析</p><h3 id="第一步：读取并检查输入">第一步：读取并检查输入</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">401106:	call   40145c &lt;read_six_numbers&gt; ; 读取 6 个数字</span><br></pre></td></tr></table></figure><ul><li><code>read_six_numbers</code>函数我们之前在 phase_2 见过了，这个函数读取我们输入的 6 个整数并分配到栈上，此时，栈顶指针<code>%rsp</code>指向数组开头<code>input[0]</code>的地址</li></ul><p>接下来的 <code>40110b</code> 到 <code>401151</code> 这段代码是一个<strong>双重循环</strong>：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">40111b:	sub    $0x1,%eax            ; input[i] - 1</span><br><span class="line">40111e:	cmp    $0x5,%eax            ; 必须 &lt;= 5</span><br><span class="line">401121:	jbe    ...                  ; 否则炸</span><br></pre></td></tr></table></figure><ul><li><strong>条件 1</strong>：每个数字必须在 <code>1</code> 到 <code>6</code> 之间。</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">40113b:	cmp    %eax,0x0(%rbp)       ; 比较 input[i] 和 input[j]</span><br><span class="line">40113e:	jne    ...                  ; 如果相等，炸</span><br></pre></td></tr></table></figure><ul><li><strong>条件 2</strong>：这 6 个数字必须 <strong>互不相同</strong>。</li><li><strong>结论</strong>：输入的 6 个数是 <strong>1 到 6 的全排列</strong> (比如 <code>3 2 1 6 5 4</code>)。</li></ul><hr><h3 id="第二步：数值反转">第二步：数值反转</h3><p>这段代码很关键：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">401153:	lea    0x18(%rsp),%rsi      ; 数组结尾</span><br><span class="line">...</span><br><span class="line">401160:	mov    %ecx,%edx            ; %ecx = 7</span><br><span class="line">401162:	sub    (%rax),%edx          ; %edx = 7 - input[i]</span><br><span class="line">401164:	mov    %edx,(%rax)          ; input[i] = 7 - input[i]</span><br></pre></td></tr></table></figure><ul><li><strong>作用</strong>：把每个输入的数字 <code>x</code> 变成 <code>7 - x</code>。<ul><li>如果你输入 <code>1</code>，它变成 <code>6</code>。</li><li>如果你输入 <code>6</code>，它变成 <code>1</code>。</li></ul></li></ul><hr><h3 id="第三步：链表重组">第三步：链表重组</h3><p>这就是本关的核心。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">401183:	mov    $0x6032d0,%edx       ; 【关键】链表头地址 Node 1</span><br></pre></td></tr></table></figure><p>这段代码（<code>401176</code> 到 <code>4011ab</code>）的作用是：</p><ul><li>内存里有 6 个节点（Node），每个节点存了一个值和下一个节点的指针。</li><li>程序根据你输入的数字（变换后的 <code>7-x</code>），把这 6 个节点按照你指定的顺序，<strong>重新排队</strong>。</li><li>比如你的输入对应的是 <code>3 1 ...</code>，那么现在的链表顺序就变成了 <code>Node 3 -&gt; Node 1 -&gt; ...</code>。</li></ul><p><strong>我们先不去深究这里的指针操作，直接看最后的检查条件。</strong></p><hr><h3 id="第四步：链表排序检查">第四步：链表排序检查</h3><p>程序最后会遍历这个重新排好序的链表：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">4011df:	mov    0x8(%rbx),%rax       ; %rax = 当前节点的下一个节点 (Next Node)</span><br><span class="line">4011e3:	mov    (%rax),%eax          ; 取出 下一个节点的值 (Value)</span><br><span class="line">4011e5:	cmp    %eax,(%rbx)          ; 比较 当前节点的值 vs 下一个节点的值</span><br><span class="line">4011e7:	jge    4011ee               ; 如果 Current &gt;= Next，继续</span><br><span class="line">4011e9:	call   &lt;explode_bomb&gt;       ; 否则炸！</span><br></pre></td></tr></table></figure><ul><li><strong>条件</strong>：<code>Current_Value &gt;= Next_Value</code></li><li><strong>结论</strong>：重组后的链表，节点里的值必须是 <strong>从大到小</strong> 排序的！</li></ul><hr><h3 id="破解行动">破解行动</h3><p>我们不需要手动去推指针，我们只需要知道：</p><ol><li>这 6 个节点里存的值分别是多少？</li><li>哪个节点的值最大，哪个最小？</li><li>按从大到小的顺序，它们原本的索引（编号）是多少？</li></ol><h4 id="1-探查链表数据">1. 探查链表数据</h4><p>在 GDB 中，我们看到链表头是 <code>0x6032d0</code>。<br>链表节点的结构通常是：</p><ul><li><code>Offset 0</code>: <strong>Value (4 字节)</strong></li><li><code>Offset 8</code>: <strong>Next Pointer (8 字节)</strong></li></ul><p>我们来查看这 6 个节点：</p><p><strong>Node 1 (0x6032d0):</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">x/d 0x6032d0        -&gt; 查看值</span><br><span class="line">x/gx 0x6032d0+8     -&gt; 查看下一个节点的地址</span><br></pre></td></tr></table></figure><ul><li><strong>Node 1</strong>: Value = <strong>332</strong> (0x14c)</li><li><strong>Node 2</strong>: Value = <strong>168</strong> (0xa8)</li><li><strong>Node 3</strong>: Value = <strong>924</strong> (0x39c)</li><li><strong>Node 4</strong>: Value = <strong>691</strong> (0x2b3)</li><li><strong>Node 5</strong>: Value = <strong>477</strong> (0x1dd)</li><li><strong>Node 6</strong>: Value = <strong>443</strong> (0x1bb)</li></ul><h4 id="2-排序">2. 排序</h4><p>我们把刚才找到的值按 <strong>从大到小</strong> 排序：</p><ol><li><strong>Node 3</strong>: 924</li><li><strong>Node 4</strong>: 691</li><li><strong>Node 5</strong>: 477</li><li><strong>Node 6</strong>: 443</li><li><strong>Node 1</strong>: 332</li><li><strong>Node 2</strong>: 168</li></ol><p>对应的节点编号顺序是：<strong>3, 4, 5, 6, 1, 2</strong></p><h4 id="3-反转陷阱">3. 反转陷阱</h4><p>还记得第二步里的 <code>7 - x</code> 吗？<br>程序是按 <code>7 - input</code> 来重排链表的。<br>所以：<br><code>7 - input[0] = 3</code> =&gt; <code>input[0] = 4</code><br><code>7 - input[1] = 4</code> =&gt; <code>input[1] = 3</code><br><code>7 - input[2] = 5</code> =&gt; <code>input[2] = 2</code><br><code>7 - input[3] = 6</code> =&gt; <code>input[3] = 1</code><br><code>7 - input[4] = 1</code> =&gt; <code>input[4] = 6</code><br><code>7 - input[5] = 2</code> =&gt; <code>input[5] = 5</code></p><p><strong>最终答案：</strong> <strong>4 3 2 1 6 5</strong></p></article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a><a class="post-meta__tags" href="/tags/%E6%B1%87%E7%BC%96/">汇编</a><a class="post-meta__tags" href="/tags/%E8%AE%A1%E7%BB%84/">计组</a></div><div class="post-share"><div class="social-share" data-image="/images/avatar.webp" data-sites="facebook,x,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.6/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/post/6558428b.html" title="为WSL设置代理"><div class="cover" style="background:var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">为WSL设置代理</div></div><div class="info-2"><div class="info-item-1">为 WSL2 设置代理 WSL 有两个配置文件： .wslconfig：适用于所有 WSL 的配置 wsl.conf：在/etc目录下，仅适用于对应的特定 Linux 发行版 .wslconfig文件在~/目录下，即C:\Users\&lt;UserName&gt;\.wslconfig 但是.wslconfig文件默认并不存在，需要手动创建。 在正确的目录下创建文件，示例如下 12345678910111213141516171819[wsl2]# 开启自动代理autoProxy=true# 开启 DNS 隧道dnsTunneling=true# 开启镜像网络模式networkingMode=mirrored# 同步防火墙规则firewall=true[experimental]# 自动回收内存autoMemoryReclaim=gradual# 自动释放硬盘空间sparseVhd=true 要使 WSL 使用 Windows 的代理，需要设置autoProxy=true，强制 WSL 使用 Windows 的 HTTP 代理信息。 参考资料：</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/post/3a831366.html" title="计组——汇编学习笔记"><div class="cover" style="background:var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-10-20</div><div class="info-item-2">计组——汇编学习笔记</div></div><div class="info-2"><div class="info-item-1">计组——汇编学习 本文与著名的《深入理解计算机系统》（CS:APP）一书一样，汇编代码格式采用 AT&amp;T 格式。 AT&amp;T 格式与 Intel 格式的不同 特性 AT&amp;T 格式 Intel 格式 操作数顺序 op s,d源在左，目标在右 op d,s目标在左，源在右 寄存器表示 mov %ebx,%eax寄存器名称前加 % mov ebx,eax不带前缀 立即数表示 mov $985,%eax立即数前加 $ mov 985,%eax不带前缀 主存地址表示 (af996h)用小括号 [af996h]用中括号 读写长度表示 movl，movqb、w、l、q 分别表示 1、2、4、8 字节 mov byte ptr [af996h],5在主存地址前说明读写长度 主存偏移表示 偏移(基址, 索引, 缩放)8(%ebp)(%eax, %ebx, 4) [基址 + 索引 * 缩放 + 偏移][ebp + 8][eax + ebx * 4] 注释 # ; 内存寻址 在 AT&amp;T 语法中，一个完整的内存地址表达式格式为：...</div></div></div></a></div></div><hr class="custom-hr"><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/images/avatar.webp" onerror='this.onerror=null,this.src="/images/friend_404.gif"' alt="avatar"></div><div class="author-info-name">EchoCyan</div><div class="author-info-description">舰艏上浪的个人博客</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">13</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">22</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/echocyan"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">美妙人生的关键在于你能迷上什么东西</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">CSAPP 实验 2 ：Bomb Lab</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E8%A8%80"><span class="toc-number">1.1.</span> <span class="toc-text">引言</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="toc-number">1.1.1.</span> <span class="toc-text">基础知识</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#GDB-%E8%B0%83%E8%AF%95%E5%99%A8%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">GDB 调试器常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%90%AF%E5%8A%A8%E4%B8%8E%E8%BF%90%E8%A1%8C"><span class="toc-number">1.1.1.1.1.</span> <span class="toc-text">1. 启动与运行</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E6%96%AD%E7%82%B9%E6%8E%A7%E5%88%B6"><span class="toc-number">1.1.1.1.2.</span> <span class="toc-text">2. 断点控制</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-%E6%9F%A5%E7%9C%8B%E4%BB%A3%E7%A0%81%E4%B8%8E%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">1.1.1.1.3.</span> <span class="toc-text">3. 查看代码与寄存器</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-%E6%A0%B8%E5%BF%83%E5%91%BD%E4%BB%A4%EF%BC%9A%E6%9F%A5%E7%9C%8B%E5%86%85%E5%AD%98-x"><span class="toc-number">1.1.1.1.4.</span> <span class="toc-text">4. 核心命令：查看内存 (x)</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#x86-64-%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">x86-64 寄存器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#phase-1"><span class="toc-number">1.2.</span> <span class="toc-text">phase_1</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#phade-2"><span class="toc-number">1.3.</span> <span class="toc-text">phade_2</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#phase-3"><span class="toc-number">1.4.</span> <span class="toc-text">phase_3</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#phase-4"><span class="toc-number">1.5.</span> <span class="toc-text">phase_4</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#phase-5"><span class="toc-number">1.6.</span> <span class="toc-text">phase_5</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#phase-6"><span class="toc-number">1.7.</span> <span class="toc-text">phase_6</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5%EF%BC%9A%E8%AF%BB%E5%8F%96%E5%B9%B6%E6%A3%80%E6%9F%A5%E8%BE%93%E5%85%A5"><span class="toc-number">1.7.1.</span> <span class="toc-text">第一步：读取并检查输入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5%EF%BC%9A%E6%95%B0%E5%80%BC%E5%8F%8D%E8%BD%AC"><span class="toc-number">1.7.2.</span> <span class="toc-text">第二步：数值反转</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%AD%A5%EF%BC%9A%E9%93%BE%E8%A1%A8%E9%87%8D%E7%BB%84"><span class="toc-number">1.7.3.</span> <span class="toc-text">第三步：链表重组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E6%AD%A5%EF%BC%9A%E9%93%BE%E8%A1%A8%E6%8E%92%E5%BA%8F%E6%A3%80%E6%9F%A5"><span class="toc-number">1.7.4.</span> <span class="toc-text">第四步：链表排序检查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A0%B4%E8%A7%A3%E8%A1%8C%E5%8A%A8"><span class="toc-number">1.7.5.</span> <span class="toc-text">破解行动</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E6%8E%A2%E6%9F%A5%E9%93%BE%E8%A1%A8%E6%95%B0%E6%8D%AE"><span class="toc-number">1.7.5.1.</span> <span class="toc-text">1. 探查链表数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E6%8E%92%E5%BA%8F"><span class="toc-number">1.7.5.2.</span> <span class="toc-text">2. 排序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%8F%8D%E8%BD%AC%E9%99%B7%E9%98%B1"><span class="toc-number">1.7.5.3.</span> <span class="toc-text">3. 反转陷阱</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/50d220bf.html" title="CSAPP 实验 2 ：Bomb Lab">CSAPP 实验 2 ：Bomb Lab</a><time datetime="2025-11-25T12:30:58.000Z" title="发表于 2025-11-25 20:30:58">2025-11-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/6558428b.html" title="为WSL设置代理">为WSL设置代理</a><time datetime="2025-11-21T17:04:33.000Z" title="发表于 2025-11-22 01:04:33">2025-11-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/e1113bf9.html" title="计算机网络——应用层">计算机网络——应用层</a><time datetime="2025-11-17T15:07:25.000Z" title="发表于 2025-11-17 23:07:25">2025-11-17</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By EchoCyan</span><span class="framework-info"><span>框架</span> <a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.1.1</a><span class="footer-separator">|</span><span>主题</span> <a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.2</a></span></div><div class="footer_custom_text"><a href="https://icp.gov.moe/?keyword=20250489" target="_blank">萌ICP备20250489号</a><br><span id="workboard"></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.5.2/source/js/utils.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.5.2/source/js/main.min.js"></script><div class="js-pjax"><script>(()=>{const t=()=>{if(window.MathJax)MathJax.startup.document.state(0),MathJax.texReset(),MathJax.typesetPromise();else{window.MathJax={loader:{load:["[tex]/mhchem"],paths:{"mathjax-newcm":"[mathjax]/../@mathjax/mathjax-newcm-font","mathjax-mhchem-extension":"[mathjax]/../@mathjax/mathjax-mhchem-font-extension"}},output:{font:"mathjax-newcm"},tex:{inlineMath:[["$","$"],["\\(","\\)"]],tags:"none",packages:{"[+]":["mhchem"]}},chtml:{scale:1.1},options:{enableMenu:!0,menuOptions:{settings:{enrich:!1}},renderActions:{findScript:[10,t=>{for(const e of document.querySelectorAll('script[type^="math/tex"]')){const a=!!e.type.match(/; *mode=display/),n=new t.options.MathItem(e.textContent,t.inputJax[0],a),m=document.createTextNode("");e.parentNode.replaceChild(m,e),n.start={node:m,delim:"",n:0},n.end={node:m,delim:"",n:0},t.math.push(n)}},""]}}};const t=document.createElement("script");t.src="https://cdn.jsdelivr.net/npm/mathjax@4.0.0/tex-mml-chtml.min.js",t.id="MathJax-script",t.async=!0,document.head.appendChild(t)}};btf.addGlobalFn("encrypt",t,"mathjax"),window.pjax?t():window.addEventListener("load",t)})()</script><script>(()=>{const o="shuoshuo"===GLOBAL_CONFIG_SITE.pageType,t=null,e=(e=document,n=location.pathname)=>{twikoo.init({el:e.querySelector("#twikoo-wrap"),envId:"https://twikoo.echocyan.top/",region:"",onCommentLoaded:()=>{btf.loadLightbox(document.querySelectorAll("#twikoo .tk-content img:not(.tk-owo-emotion)"))},...t,path:n}),o&&(window.shuoshuoComment.destroyTwikoo=()=>{e.children.length&&(e.innerHTML="",e.classList.add("no-comment"))})},n=(o,t)=>{"object"==typeof twikoo?setTimeout(()=>e(o,t),0):btf.getScript("https://cdn.jsdelivr.net/npm/twikoo@1.6.44/dist/twikoo.all.min.js").then(()=>e(o,t))};o?window.shuoshuoComment={loadComment:n}:n()})()</script></div><script defer="defer" src="/js/runtime.js"></script><script src="/js/meng-ipc.js"></script><canvas id="universe"></canvas><script defer="defer" src="/js/universe.js"></script><script async data-pjax src="/"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><i class="fas fa-spinner fa-pulse" id="loading-status" hidden="hidden"></i><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i> <span>数据加载中</span></div><div class="local-search-input"><input placeholder="搜索文章" type="text"></div><hr><div id="local-search-results"></div><div class="ais-Pagination" id="local-search-pagination" style="display:none"><ul class="ais-Pagination-list"></ul></div><div id="local-search-stats"></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.5.2/source/js/search/local-search.min.js"></script></div></div></body></html>